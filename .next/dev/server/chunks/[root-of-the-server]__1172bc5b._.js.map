{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///Users/nishibhagat/stagehandsdk/src/utils.ts"],"sourcesContent":["import chalk from 'chalk';\n\nexport function log(message: string, type: 'info' | 'success' | 'error' | 'warn' = 'info') {\n  const prefix = {\n    info: chalk.blue('ℹ'),\n    success: chalk.green('✓'),\n    error: chalk.red('✗'),\n    warn: chalk.yellow('⚠'),\n  };\n\n  console.log(`${prefix[type]} ${message}`);\n}\n\nexport function formatDate(): string {\n  return new Date().toISOString().split('T')[0];\n}\n\nexport function sanitizeFilename(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/[^a-z0-9]/g, '-')\n    .replace(/-+/g, '-')\n    .replace(/^-|-$/g, '');\n}\n\nexport async function delay(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport function buildSearchQuery(companyName: string, ...keywords: string[]): string {\n  return `${companyName} ${keywords.join(' ')}`;\n}\n\nexport interface RetryOptions {\n  maxRetries?: number;\n  initialDelay?: number;\n  maxDelay?: number;\n  backoffMultiplier?: number;\n  shouldRetry?: (error: any) => boolean;\n}\n\n/**\n * Retry a function with exponential backoff\n */\nexport async function retryWithBackoff<T>(\n  fn: () => Promise<T>,\n  options: RetryOptions = {}\n): Promise<T> {\n  const {\n    maxRetries = 3,\n    initialDelay = 1000,\n    maxDelay = 10000,\n    backoffMultiplier = 2,\n    shouldRetry = () => true,\n  } = options;\n\n  let lastError: any;\n  let currentDelay = initialDelay;\n\n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\n    try {\n      return await fn();\n    } catch (error) {\n      lastError = error;\n\n      // Check if we should retry this error\n      if (!shouldRetry(error)) {\n        throw error;\n      }\n\n      // If this was the last attempt, throw the error\n      if (attempt === maxRetries) {\n        throw error;\n      }\n\n      // Log retry attempt\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      log(\n        `Attempt ${attempt + 1}/${maxRetries + 1} failed: ${errorMessage}. Retrying in ${currentDelay}ms...`,\n        'warn'\n      );\n\n      // Wait before retrying\n      await delay(currentDelay);\n\n      // Increase delay for next attempt (exponential backoff)\n      currentDelay = Math.min(currentDelay * backoffMultiplier, maxDelay);\n    }\n  }\n\n  throw lastError;\n}\n\n/**\n * Check if an error is retryable (network errors, timeouts, parse errors)\n */\nexport function isRetryableError(error: any): boolean {\n  if (!error) return false;\n\n  const errorMessage = error instanceof Error ? error.message : String(error);\n  const errorName = error instanceof Error ? error.name : error?.constructor?.name || '';\n\n  // Retry on parse errors, timeouts, and network errors\n  return (\n    errorName.includes('ParseError') ||\n    errorName.includes('TimeoutError') ||\n    errorName.includes('NetworkError') ||\n    errorMessage.includes('parse') ||\n    errorMessage.includes('timeout') ||\n    errorMessage.includes('Timeout') ||\n    errorMessage.includes('network') ||\n    errorMessage.includes('ECONNREFUSED') ||\n    errorMessage.includes('ETIMEDOUT') ||\n    errorMessage.includes('Failed to parse')\n  );\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;AAEO,SAAS,IAAI,OAAe,EAAE,OAA8C,MAAM;IACvF,MAAM,SAAS;QACb,MAAM,qKAAK,CAAC,IAAI,CAAC;QACjB,SAAS,qKAAK,CAAC,KAAK,CAAC;QACrB,OAAO,qKAAK,CAAC,GAAG,CAAC;QACjB,MAAM,qKAAK,CAAC,MAAM,CAAC;IACrB;IAEA,QAAQ,GAAG,CAAC,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS;AAC1C;AAEO,SAAS;IACd,OAAO,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;AAC/C;AAEO,SAAS,iBAAiB,IAAY;IAC3C,OAAO,KACJ,WAAW,GACX,OAAO,CAAC,cAAc,KACtB,OAAO,CAAC,OAAO,KACf,OAAO,CAAC,UAAU;AACvB;AAEO,eAAe,MAAM,EAAU;IACpC,OAAO,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;AACpD;AAEO,SAAS,iBAAiB,WAAmB,EAAE,GAAG,QAAkB;IACzE,OAAO,GAAG,YAAY,CAAC,EAAE,SAAS,IAAI,CAAC,MAAM;AAC/C;AAaO,eAAe,iBACpB,EAAoB,EACpB,UAAwB,CAAC,CAAC;IAE1B,MAAM,EACJ,aAAa,CAAC,EACd,eAAe,IAAI,EACnB,WAAW,KAAK,EAChB,oBAAoB,CAAC,EACrB,cAAc,IAAM,IAAI,EACzB,GAAG;IAEJ,IAAI;IACJ,IAAI,eAAe;IAEnB,IAAK,IAAI,UAAU,GAAG,WAAW,YAAY,UAAW;QACtD,IAAI;YACF,OAAO,MAAM;QACf,EAAE,OAAO,OAAO;YACd,YAAY;YAEZ,sCAAsC;YACtC,IAAI,CAAC,YAAY,QAAQ;gBACvB,MAAM;YACR;YAEA,gDAAgD;YAChD,IAAI,YAAY,YAAY;gBAC1B,MAAM;YACR;YAEA,oBAAoB;YACpB,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;YACrE,IACE,CAAC,QAAQ,EAAE,UAAU,EAAE,CAAC,EAAE,aAAa,EAAE,SAAS,EAAE,aAAa,cAAc,EAAE,aAAa,KAAK,CAAC,EACpG;YAGF,uBAAuB;YACvB,MAAM,MAAM;YAEZ,wDAAwD;YACxD,eAAe,KAAK,GAAG,CAAC,eAAe,mBAAmB;QAC5D;IACF;IAEA,MAAM;AACR;AAKO,SAAS,iBAAiB,KAAU;IACzC,IAAI,CAAC,OAAO,OAAO;IAEnB,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;IACrE,MAAM,YAAY,iBAAiB,QAAQ,MAAM,IAAI,GAAG,OAAO,aAAa,QAAQ;IAEpF,sDAAsD;IACtD,OACE,UAAU,QAAQ,CAAC,iBACnB,UAAU,QAAQ,CAAC,mBACnB,UAAU,QAAQ,CAAC,mBACnB,aAAa,QAAQ,CAAC,YACtB,aAAa,QAAQ,CAAC,cACtB,aAAa,QAAQ,CAAC,cACtB,aAAa,QAAQ,CAAC,cACtB,aAAa,QAAQ,CAAC,mBACtB,aAAa,QAAQ,CAAC,gBACtB,aAAa,QAAQ,CAAC;AAE1B"}},
    {"offset": {"line": 172, "column": 0}, "map": {"version":3,"sources":["file:///Users/nishibhagat/stagehandsdk/src/exa-researcher.ts"],"sourcesContent":["import Exa from 'exa-js';\nimport {\n  CompanyInfo,\n  News,\n  NewsItem,\n  TechStack,\n  Competitors,\n  Competitor,\n  CompanyResearchReport\n} from './types';\nimport { log } from './utils';\n\n/**\n * Fast company researcher using Exa AI Search API\n * Much faster than browser automation (~500ms vs 30-60s)\n */\nexport class ExaResearcher {\n  private exa: Exa;\n\n  constructor() {\n    const apiKey = process.env.EXA_API_KEY;\n    if (!apiKey) {\n      throw new Error('EXA_API_KEY is required for fast search');\n    }\n    this.exa = new Exa(apiKey);\n  }\n\n  /**\n   * Fast company research using Exa API\n   * Returns results in seconds instead of minutes\n   */\n  async research(companyName: string): Promise<CompanyResearchReport> {\n    log(`[Exa] Starting fast research for: ${companyName}`, 'info');\n    const startTime = Date.now();\n\n    // Run all searches in parallel for maximum speed\n    const [companyInfo, news, competitors, techStack] = await Promise.all([\n      this.extractCompanyInfo(companyName),\n      this.extractNews(companyName),\n      this.extractCompetitors(companyName),\n      this.extractTechStack(companyName),\n    ]);\n\n    const duration = ((Date.now() - startTime) / 1000).toFixed(2);\n    log(`[Exa] Research completed in ${duration}s`, 'success');\n\n    return {\n      companyInfo,\n      news,\n      techStack,\n      competitors,\n      researchDate: new Date().toISOString(),\n    };\n  }\n\n  private async extractCompanyInfo(companyName: string): Promise<CompanyInfo> {\n    log('[Exa] Extracting company info...', 'info');\n\n    try {\n      // Search for company info with content extraction\n      const result = await this.exa.searchAndContents(\n        `${companyName} company official website about`,\n        {\n          type: 'auto',\n          numResults: 3,\n          category: 'company',\n          text: { maxCharacters: 2000 },\n          summary: true,\n          livecrawl: 'preferred',\n        }\n      );\n\n      // Also search for specific company details\n      const detailsResult = await this.exa.searchAndContents(\n        `${companyName} headquarters location industry founded`,\n        {\n          type: 'auto',\n          numResults: 3,\n          text: { maxCharacters: 1000 },\n          summary: true,\n        }\n      );\n\n      // Extract info from results\n      const mainResult = result.results[0];\n      const detailResult = detailsResult.results[0];\n\n      // Parse the summary and text for structured info\n      const description = mainResult?.summary || mainResult?.text?.slice(0, 500) || `${companyName} is a technology company.`;\n      const detailText = (detailResult?.summary || detailResult?.text || '').toLowerCase();\n\n      // Try to extract headquarters from text\n      let headquarters = 'Not specified';\n      const hqPatterns = [\n        /headquartered in ([^,.]+)/i,\n        /headquarters in ([^,.]+)/i,\n        /based in ([^,.]+)/i,\n        /located in ([^,.]+)/i,\n      ];\n      for (const pattern of hqPatterns) {\n        const match = detailText.match(pattern);\n        if (match) {\n          headquarters = match[1].trim();\n          break;\n        }\n      }\n\n      // Try to extract industry\n      let industry = 'Technology';\n      const industryKeywords = ['fintech', 'ai', 'artificial intelligence', 'e-commerce', 'saas', 'payments', 'cloud', 'software', 'healthcare', 'biotech'];\n      for (const keyword of industryKeywords) {\n        if (detailText.includes(keyword)) {\n          industry = keyword.charAt(0).toUpperCase() + keyword.slice(1);\n          break;\n        }\n      }\n\n      const companyInfo: CompanyInfo = {\n        name: companyName,\n        description,\n        mission: mainResult?.text?.slice(0, 300) || description,\n        headquarters,\n        industry,\n        website: mainResult?.url || `https://www.${companyName.toLowerCase().replace(/\\s+/g, '')}.com`,\n      };\n\n      log('[Exa] Company info extracted', 'success');\n      return companyInfo;\n    } catch (error) {\n      log(`[Exa] Failed to extract company info: ${error}`, 'warn');\n      return {\n        name: companyName,\n        description: `${companyName} is a technology company.`,\n        mission: 'Information not available',\n        headquarters: 'Not specified',\n        industry: 'Technology',\n        website: `https://www.${companyName.toLowerCase().replace(/\\s+/g, '')}.com`,\n      };\n    }\n  }\n\n  private async extractNews(companyName: string): Promise<News> {\n    log('[Exa] Extracting news...', 'info');\n\n    try {\n      const result = await this.exa.searchAndContents(\n        `${companyName} company news announcement`,\n        {\n          type: 'auto',\n          numResults: 5,\n          category: 'news',\n          text: { maxCharacters: 500 },\n          summary: true,\n          livecrawl: 'preferred',\n        }\n      );\n\n      const news: NewsItem[] = result.results.map((item) => ({\n        title: item.title || 'Untitled',\n        date: item.publishedDate || new Date().toISOString().split('T')[0],\n        source: new URL(item.url).hostname.replace('www.', ''),\n        summary: item.summary || item.text?.slice(0, 200) || 'No summary available',\n        url: item.url,\n      }));\n\n      log(`[Exa] Found ${news.length} news items`, 'success');\n      return news;\n    } catch (error) {\n      log(`[Exa] Failed to extract news: ${error}`, 'warn');\n      return [];\n    }\n  }\n\n  private async extractCompetitors(companyName: string): Promise<Competitors> {\n    log('[Exa] Extracting competitors...', 'info');\n\n    try {\n      const result = await this.exa.searchAndContents(\n        `${companyName} competitors alternatives similar companies`,\n        {\n          type: 'auto',\n          numResults: 7,\n          category: 'company',\n          text: { maxCharacters: 500 },\n          summary: true,\n        }\n      );\n\n      // Also do a direct search for competitor analysis\n      const analysisResult = await this.exa.searchAndContents(\n        `\"${companyName}\" competitor analysis market`,\n        {\n          type: 'auto',\n          numResults: 3,\n          text: { maxCharacters: 1000 },\n          summary: true,\n        }\n      );\n\n      // Extract competitor names from results\n      const competitors: Competitor[] = [];\n      const seenNames = new Set([companyName.toLowerCase()]);\n\n      // Try to parse competitors from analysis text\n      const analysisText = analysisResult.results[0]?.text || analysisResult.results[0]?.summary || '';\n\n      // Common competitor patterns\n      const competitorPatterns = [\n        /competitors?\\s+(?:include|are|such as)\\s+([^.]+)/gi,\n        /competes?\\s+with\\s+([^.]+)/gi,\n        /alternatives?\\s+(?:to|include)\\s+([^.]+)/gi,\n      ];\n\n      for (const pattern of competitorPatterns) {\n        const matches = analysisText.matchAll(pattern);\n        for (const match of matches) {\n          const names = match[1].split(/,|and/).map(n => n.trim()).filter(n => n.length > 2 && n.length < 50);\n          for (const name of names) {\n            if (!seenNames.has(name.toLowerCase())) {\n              seenNames.add(name.toLowerCase());\n              competitors.push({\n                name,\n                description: `Competitor in the same market as ${companyName}`,\n                website: null,\n              });\n            }\n          }\n        }\n      }\n\n      // Add results from company search\n      for (const item of result.results) {\n        const name = item.title?.split(/[-–|]/)[0]?.trim() || '';\n        if (name && !seenNames.has(name.toLowerCase()) && name.toLowerCase() !== companyName.toLowerCase()) {\n          seenNames.add(name.toLowerCase());\n          competitors.push({\n            name,\n            description: item.summary || item.text?.slice(0, 200) || 'No description available',\n            website: item.url,\n          });\n        }\n      }\n\n      log(`[Exa] Found ${competitors.length} competitors`, 'success');\n      return competitors.slice(0, 7);\n    } catch (error) {\n      log(`[Exa] Failed to extract competitors: ${error}`, 'warn');\n      return [];\n    }\n  }\n\n  private async extractTechStack(companyName: string): Promise<TechStack> {\n    log('[Exa] Extracting tech stack...', 'info');\n\n    try {\n      const result = await this.exa.searchAndContents(\n        `${companyName} engineering tech stack technologies programming languages`,\n        {\n          type: 'auto',\n          numResults: 5,\n          text: { maxCharacters: 1500 },\n          summary: true,\n        }\n      );\n\n      // Also search for job postings\n      const jobsResult = await this.exa.searchAndContents(\n        `${companyName} careers jobs software engineer requirements`,\n        {\n          type: 'auto',\n          numResults: 3,\n          text: { maxCharacters: 1000 },\n        }\n      );\n\n      // Combine all text for analysis\n      const allText = [\n        ...result.results.map(r => r.text || r.summary || ''),\n        ...jobsResult.results.map(r => r.text || ''),\n      ].join(' ').toLowerCase();\n\n      // Define tech categories\n      const languageKeywords = ['python', 'javascript', 'typescript', 'java', 'go', 'golang', 'rust', 'c++', 'ruby', 'scala', 'kotlin', 'swift', 'php'];\n      const frameworkKeywords = ['react', 'next.js', 'vue', 'angular', 'django', 'flask', 'express', 'fastapi', 'spring', 'rails', 'node.js', 'tensorflow', 'pytorch'];\n      const toolKeywords = ['docker', 'kubernetes', 'git', 'jenkins', 'terraform', 'ansible', 'grafana', 'prometheus', 'elasticsearch', 'redis', 'kafka', 'rabbitmq'];\n      const infraKeywords = ['aws', 'gcp', 'azure', 'cloudflare', 'vercel', 'heroku', 'digitalocean', 'mongodb', 'postgresql', 'mysql', 'dynamodb', 's3'];\n\n      const techStack: TechStack = {\n        languages: languageKeywords.filter(k => allText.includes(k)),\n        frameworks: frameworkKeywords.filter(k => allText.includes(k.toLowerCase())),\n        tools: toolKeywords.filter(k => allText.includes(k)),\n        infrastructure: infraKeywords.filter(k => allText.includes(k)),\n      };\n\n      log('[Exa] Tech stack extracted', 'success');\n      return techStack;\n    } catch (error) {\n      log(`[Exa] Failed to extract tech stack: ${error}`, 'warn');\n      return {\n        languages: [],\n        frameworks: [],\n        tools: [],\n        infrastructure: [],\n      };\n    }\n  }\n}\n\n/**\n * Check if Exa is available (API key configured)\n */\nexport function isExaAvailable(): boolean {\n  return !!process.env.EXA_API_KEY;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 511, "column": 0}, "map": {"version":3,"sources":["file:///Users/nishibhagat/stagehandsdk/src/init.ts"],"sourcesContent":["// This file MUST be imported first in server.ts and scraper.ts\n// It configures the environment to prevent pino-pretty errors in serverless environments\n\nimport { createRequire } from 'module';\nimport { Transform } from 'stream';\n\n// Detect if we're in a serverless/production environment\nconst isServerless = !!(\n  process.env.VERCEL ||\n  process.env.AWS_LAMBDA_FUNCTION_NAME ||\n  process.env.NETLIFY ||\n  process.env.NODE_ENV === 'production'\n);\n\nif (isServerless) {\n  console.log('[Init] Detected serverless environment, disabling pino-pretty');\n}\n\n// Configure environment variables to disable pino-pretty before any modules load\nprocess.env.LOG_LEVEL = process.env.LOG_LEVEL || 'info';\ndelete process.env.PINO_PRETTY; // Remove any pino-pretty config\ndelete process.env.PINO_TRANSPORT_TARGET; // Disable transports\n\n// Mock pino-pretty module to prevent it from loading\n// This is necessary because Stagehand SDK has pino-pretty as a dependency\nconst require = createRequire(import.meta.url);\nconst Module = require('module');\nconst originalRequire = Module.prototype.require;\n\nModule.prototype.require = function (id: string) {\n  // Intercept pino-pretty and return a no-op function\n  if (id === 'pino-pretty') {\n    return function pinoPrettyMock() {\n      // Return a basic transform stream that does nothing\n      return new Transform({\n        transform(chunk: any, encoding: string, callback: Function) {\n          callback(null, chunk);\n        }\n      });\n    };\n  }\n\n  // For all other requires, use the original\n  return originalRequire.apply(this, arguments as any);\n};\n\n// Set up global error/warning handler to suppress pino-pretty errors\nconst originalEmit = process.emit;\n(process as any).emit = function (event: any, ...args: any[]) {\n  // Suppress pino-pretty related warnings and errors\n  if (event === 'warning' && args[0]) {\n    const warning = args[0];\n    const message = warning?.message || String(warning);\n\n    if (message.includes('pino-pretty') || message.includes('pino') && message.includes('transport')) {\n      // Silently ignore pino-pretty warnings\n      return false;\n    }\n  }\n\n  if ((event === 'uncaughtException' || event === 'unhandledRejection')) {\n    const error = args[0];\n    if (error && typeof error === 'object') {\n      const message = error.message || String(error);\n\n      // Suppress pino-pretty transport errors\n      if (message.includes('unable to determine transport target') ||\n          message.includes('pino-pretty') ||\n          (message.includes('pino') && message.includes('target'))) {\n        console.warn('[Init] Suppressed pino-pretty error (expected in serverless)');\n        return true; // Mark as handled\n      }\n    }\n  }\n\n  // For all other events, use original emit\n  return originalEmit.apply(this, arguments as any);\n};\n\n// Prevent unhandled rejection crashes from pino-pretty\nprocess.on('unhandledRejection', (reason: any) => {\n  const message = reason?.message || String(reason);\n  if (message.includes('pino-pretty') || message.includes('unable to determine transport target')) {\n    // Ignore pino-pretty errors\n    return;\n  }\n  // Re-throw other unhandled rejections\n  throw reason;\n});\n\nexport {};\n"],"names":[],"mappings":";AAAA,+DAA+D;AAC/D,yFAAyF;AAEzF;AACA;;;;;;;;AAEA,yDAAyD;AACzD,MAAM,eAAe,CAAC,CAAC,CACrB,QAAQ,GAAG,CAAC,MAAM,IAClB,QAAQ,GAAG,CAAC,wBAAwB,IACpC,QAAQ,GAAG,CAAC,OAAO,IACnB,oDAAyB,YAC3B;AAEA,IAAI,cAAc;IAChB,QAAQ,GAAG,CAAC;AACd;AAEA,iFAAiF;AACjF,QAAQ,GAAG,CAAC,SAAS,GAAG,QAAQ,GAAG,CAAC,SAAS,IAAI;AACjD,OAAO,QAAQ,GAAG,CAAC,WAAW,EAAE,gCAAgC;AAChE,OAAO,QAAQ,GAAG,CAAC,qBAAqB,EAAE,qBAAqB;AAE/D,qDAAqD;AACrD,0EAA0E;AAC1E,MAAM,UAAU,IAAA,sHAAa,EAAC,8BAAY,GAAG;AAC7C,MAAM;AACN,MAAM,kBAAkB,OAAO,SAAS,CAAC,OAAO;AAEhD,OAAO,SAAS,CAAC,OAAO,GAAG,SAAU,EAAU;IAC7C,oDAAoD;IACpD,IAAI,OAAO,eAAe;QACxB,OAAO,SAAS;YACd,oDAAoD;YACpD,OAAO,IAAI,kHAAS,CAAC;gBACnB,WAAU,KAAU,EAAE,QAAgB,EAAE,QAAkB;oBACxD,SAAS,MAAM;gBACjB;YACF;QACF;IACF;IAEA,2CAA2C;IAC3C,OAAO,gBAAgB,KAAK,CAAC,IAAI,EAAE;AACrC;AAEA,qEAAqE;AACrE,MAAM,eAAe,QAAQ,IAAI;AAChC,QAAgB,IAAI,GAAG,SAAU,KAAU,EAAE,GAAG,IAAW;IAC1D,mDAAmD;IACnD,IAAI,UAAU,aAAa,IAAI,CAAC,EAAE,EAAE;QAClC,MAAM,UAAU,IAAI,CAAC,EAAE;QACvB,MAAM,UAAU,SAAS,WAAW,OAAO;QAE3C,IAAI,QAAQ,QAAQ,CAAC,kBAAkB,QAAQ,QAAQ,CAAC,WAAW,QAAQ,QAAQ,CAAC,cAAc;YAChG,uCAAuC;YACvC,OAAO;QACT;IACF;IAEA,IAAK,UAAU,uBAAuB,UAAU,sBAAuB;QACrE,MAAM,QAAQ,IAAI,CAAC,EAAE;QACrB,IAAI,SAAS,OAAO,UAAU,UAAU;YACtC,MAAM,UAAU,MAAM,OAAO,IAAI,OAAO;YAExC,wCAAwC;YACxC,IAAI,QAAQ,QAAQ,CAAC,2CACjB,QAAQ,QAAQ,CAAC,kBAChB,QAAQ,QAAQ,CAAC,WAAW,QAAQ,QAAQ,CAAC,WAAY;gBAC5D,QAAQ,IAAI,CAAC;gBACb,OAAO,MAAM,kBAAkB;YACjC;QACF;IACF;IAEA,0CAA0C;IAC1C,OAAO,aAAa,KAAK,CAAC,IAAI,EAAE;AAClC;AAEA,uDAAuD;AACvD,QAAQ,EAAE,CAAC,sBAAsB,CAAC;IAChC,MAAM,UAAU,QAAQ,WAAW,OAAO;IAC1C,IAAI,QAAQ,QAAQ,CAAC,kBAAkB,QAAQ,QAAQ,CAAC,yCAAyC;QAC/F,4BAA4B;QAC5B;IACF;IACA,sCAAsC;IACtC,MAAM;AACR"}},
    {"offset": {"line": 712, "column": 0}, "map": {"version":3,"sources":["file:///Users/nishibhagat/stagehandsdk/src/types.ts"],"sourcesContent":["import { z } from 'zod';\n\n// Zod schemas for structured data extraction\nexport const CompanyInfoSchema = z.object({\n  name: z.string().describe('Official company name'),\n  mission: z.string().nullish().describe('Company mission statement or tagline'),\n  description: z.string().nullish().describe('Brief company description or about section'),\n  headquarters: z.string().nullish().describe('Headquarters location'),\n  industry: z.string().nullish().describe('Industry or sector'),\n  website: z.string().nullish().describe('Official website URL'),\n});\n\nexport const NewsItemSchema = z.object({\n  title: z.string().describe('News headline or title'),\n  date: z.string().describe('Publication date'),\n  source: z.string().describe('News source or publication'),\n  summary: z.string().describe('Brief summary of the news'),\n  url: z.string().optional().describe('Link to full article'),\n});\n\nexport const NewsSchema = z.object({\n  articles: z.array(NewsItemSchema).describe('Recent company news items'),\n});\n\nexport const TechStackSchema = z.object({\n  languages: z.array(z.string()).describe('Programming languages used'),\n  frameworks: z.array(z.string()).describe('Frameworks and libraries'),\n  tools: z.array(z.string()).describe('Development tools and platforms'),\n  infrastructure: z.array(z.string()).describe('Cloud and infrastructure technologies'),\n});\n\nexport const CompetitorSchema = z.object({\n  name: z.string().describe('Competitor company name'),\n  description: z.string().nullish().describe('Brief description of what they do'),\n  website: z.string().nullish().describe('Competitor website URL'),\n});\n\nexport const CompetitorsSchema = z.object({\n  competitors: z.array(CompetitorSchema).describe('Main competitors of the company'),\n});\n\n// Recruiter schemas for finding HR contacts\nexport const RecruiterSchema = z.object({\n  name: z.string().describe('Full name of the recruiter'),\n  title: z.string().describe('Job title (e.g., Technical Recruiter, Talent Acquisition Manager)'),\n  linkedInUrl: z.string().optional().describe('LinkedIn profile URL'),\n  email: z.string().optional().describe('Email address if publicly available'),\n  department: z.string().optional().describe('Department or team they recruit for'),\n});\n\nexport const RecruitersSchema = z.object({\n  recruiters: z.array(RecruiterSchema).describe('Recruiters and HR contacts at the company'),\n});\n\n// TypeScript types\nexport type CompanyInfo = z.infer<typeof CompanyInfoSchema>;\nexport type NewsItem = z.infer<typeof NewsItemSchema>;\nexport type TechStack = z.infer<typeof TechStackSchema>;\nexport type Competitor = z.infer<typeof CompetitorSchema>;\nexport type Recruiter = z.infer<typeof RecruiterSchema>;\n\n// News, Competitors, and Recruiters are arrays of items\nexport type News = NewsItem[];\nexport type Competitors = Competitor[];\nexport type Recruiters = Recruiter[];\n\nexport interface CompanyResearchReport {\n  companyInfo: CompanyInfo;\n  news: News;\n  techStack: TechStack;\n  competitors: Competitors;\n  researchDate: string;\n}\n\nexport interface ResearchOptions {\n  companyName: string;\n  outputPath?: string;\n  verbose?: boolean;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;;AAGO,MAAM,oBAAoB,wJAAC,CAAC,MAAM,CAAC;IACxC,MAAM,wJAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,SAAS,wJAAC,CAAC,MAAM,GAAG,OAAO,GAAG,QAAQ,CAAC;IACvC,aAAa,wJAAC,CAAC,MAAM,GAAG,OAAO,GAAG,QAAQ,CAAC;IAC3C,cAAc,wJAAC,CAAC,MAAM,GAAG,OAAO,GAAG,QAAQ,CAAC;IAC5C,UAAU,wJAAC,CAAC,MAAM,GAAG,OAAO,GAAG,QAAQ,CAAC;IACxC,SAAS,wJAAC,CAAC,MAAM,GAAG,OAAO,GAAG,QAAQ,CAAC;AACzC;AAEO,MAAM,iBAAiB,wJAAC,CAAC,MAAM,CAAC;IACrC,OAAO,wJAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC3B,MAAM,wJAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,QAAQ,wJAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC5B,SAAS,wJAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC7B,KAAK,wJAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;AACtC;AAEO,MAAM,aAAa,wJAAC,CAAC,MAAM,CAAC;IACjC,UAAU,wJAAC,CAAC,KAAK,CAAC,gBAAgB,QAAQ,CAAC;AAC7C;AAEO,MAAM,kBAAkB,wJAAC,CAAC,MAAM,CAAC;IACtC,WAAW,wJAAC,CAAC,KAAK,CAAC,wJAAC,CAAC,MAAM,IAAI,QAAQ,CAAC;IACxC,YAAY,wJAAC,CAAC,KAAK,CAAC,wJAAC,CAAC,MAAM,IAAI,QAAQ,CAAC;IACzC,OAAO,wJAAC,CAAC,KAAK,CAAC,wJAAC,CAAC,MAAM,IAAI,QAAQ,CAAC;IACpC,gBAAgB,wJAAC,CAAC,KAAK,CAAC,wJAAC,CAAC,MAAM,IAAI,QAAQ,CAAC;AAC/C;AAEO,MAAM,mBAAmB,wJAAC,CAAC,MAAM,CAAC;IACvC,MAAM,wJAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,aAAa,wJAAC,CAAC,MAAM,GAAG,OAAO,GAAG,QAAQ,CAAC;IAC3C,SAAS,wJAAC,CAAC,MAAM,GAAG,OAAO,GAAG,QAAQ,CAAC;AACzC;AAEO,MAAM,oBAAoB,wJAAC,CAAC,MAAM,CAAC;IACxC,aAAa,wJAAC,CAAC,KAAK,CAAC,kBAAkB,QAAQ,CAAC;AAClD;AAGO,MAAM,kBAAkB,wJAAC,CAAC,MAAM,CAAC;IACtC,MAAM,wJAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,OAAO,wJAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC3B,aAAa,wJAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IAC5C,OAAO,wJAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IACtC,YAAY,wJAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;AAC7C;AAEO,MAAM,mBAAmB,wJAAC,CAAC,MAAM,CAAC;IACvC,YAAY,wJAAC,CAAC,KAAK,CAAC,iBAAiB,QAAQ,CAAC;AAChD"}},
    {"offset": {"line": 779, "column": 0}, "map": {"version":3,"sources":["file:///Users/nishibhagat/stagehandsdk/src/scraper.ts"],"sourcesContent":["// MUST be first - configures environment to prevent pino errors\nimport './init';\nimport 'dotenv/config';\nimport { Stagehand } from '@browserbasehq/stagehand';\nimport { z } from 'zod';\nimport {\n  CompanyInfo,\n  CompanyInfoSchema,\n  News,\n  NewsSchema,\n  TechStack,\n  TechStackSchema,\n  Competitors,\n  CompetitorsSchema,\n  Recruiters,\n  RecruitersSchema,\n  CompanyResearchReport,\n} from './types';\nimport { log, delay, retryWithBackoff, isRetryableError } from './utils';\n\nexport class CompanyResearcher {\n  private stagehand: Stagehand;\n  private verbose: boolean;\n\n  constructor(verbose: boolean = false) {\n    this.verbose = verbose;\n\n    // Determine which LLM provider to use based on available API keys\n    const modelConfig = this.getModelConfig();\n\n    // Use BROWSERBASE if credentials available, otherwise LOCAL\n    const env = process.env.BROWSERBASE_API_KEY && process.env.BROWSERBASE_PROJECT_ID\n      ? 'BROWSERBASE' as const\n      : 'LOCAL' as const;\n\n    this.stagehand = new Stagehand({\n      env,\n      verbose: verbose ? 1 : 0,\n      apiKey: process.env.BROWSERBASE_API_KEY,\n      projectId: process.env.BROWSERBASE_PROJECT_ID,\n      disablePino: true,\n      disableAPI: true, // Force client-side extraction (API mode is unstable)\n      model: modelConfig.modelName ? {\n        ...modelConfig.modelClientOptions,\n        modelName: modelConfig.modelName,\n      } : undefined,\n    });\n\n    if (verbose) {\n      log(`Environment: ${env}`, 'info');\n    }\n  }\n\n  private getModelConfig(): { modelName?: string; modelClientOptions?: any } {\n    // Priority: Google Gemini > Anthropic Claude > OpenAI GPT\n    if (process.env.GOOGLE_API_KEY) {\n      return {\n        // Using gemini-2.0-flash (latest stable Gemini model supported by Stagehand)\n        modelName: 'gemini-2.0-flash',\n        modelClientOptions: {\n          apiKey: process.env.GOOGLE_API_KEY,\n        },\n      };\n    } else if (process.env.ANTHROPIC_API_KEY) {\n      return {\n        modelName: 'claude-3-5-sonnet-20241022',\n        modelClientOptions: {\n          apiKey: process.env.ANTHROPIC_API_KEY,\n        },\n      };\n    } else if (process.env.OPENAI_API_KEY) {\n      return {\n        modelName: 'gpt-4o',\n        modelClientOptions: {\n          apiKey: process.env.OPENAI_API_KEY,\n        },\n      };\n    }\n\n    return {};\n  }\n\n  private normalizeWebsite(url?: string | null): string | null {\n    if (!url) return null;\n    try {\n      const parsed = new URL(url);\n      return `${parsed.protocol}//${parsed.hostname}`;\n    } catch {\n      return null;\n    }\n  }\n\n  private sanitizeCompetitors(raw: Competitors): Competitors {\n    const blockedNamePatterns = [\n      /top\\s+\\d+/i,\n      /alternatives?/i,\n      /community/i,\n      /reddit/i,\n      /dev\\s*community/i,\n      /news/i,\n      /blog/i,\n      /forum/i,\n      /list/i,\n    ];\n    const blockedDomains = new Set([\n      'reddit.com',\n      'dev.to',\n      'medium.com',\n      'news.ycombinator.com',\n      'linkedin.com',\n      'github.com',\n      'substack.com',\n    ]);\n    const seen = new Set<string>();\n\n    return raw\n      .map((competitor) => ({\n        name: competitor?.name?.trim() ?? '',\n        description: competitor?.description?.trim() ?? null,\n        website: this.normalizeWebsite(competitor?.website ?? null),\n      }))\n      .filter((competitor) => competitor.name.length > 1)\n      .filter((competitor) => !blockedNamePatterns.some((pattern) => pattern.test(competitor.name)))\n      .filter((competitor) => {\n        if (!competitor.website) return true;\n        try {\n          const hostname = new URL(competitor.website).hostname.replace(/^www\\./, '');\n          return !blockedDomains.has(hostname);\n        } catch {\n          return false;\n        }\n      })\n      .filter((competitor) => {\n        const key = competitor.name.toLowerCase();\n        if (seen.has(key)) return false;\n        seen.add(key);\n        return true;\n      })\n      .slice(0, 7);\n  }\n\n  private guessCompanyWebsite(companyName: string): string {\n    // Common company name to website mappings\n    const knownCompanies: Record<string, string> = {\n      'stripe': 'https://stripe.com',\n      'anthropic': 'https://www.anthropic.com',\n      'openai': 'https://openai.com',\n      'google': 'https://www.google.com/about',\n      'meta': 'https://about.meta.com',\n      'facebook': 'https://about.meta.com',\n      'amazon': 'https://www.aboutamazon.com',\n      'microsoft': 'https://www.microsoft.com/about',\n      'apple': 'https://www.apple.com/about',\n      'netflix': 'https://about.netflix.com',\n      'uber': 'https://www.uber.com/about',\n      'airbnb': 'https://www.airbnb.com/about',\n      'shopify': 'https://www.shopify.com/about',\n      'salesforce': 'https://www.salesforce.com/company',\n    };\n\n    const normalized = companyName.toLowerCase().trim();\n\n    if (knownCompanies[normalized]) {\n      return knownCompanies[normalized];\n    }\n\n    // Guess based on company name\n    return `https://www.${normalized}.com`;\n  }\n\n  async initialize(): Promise<void> {\n    // Initialize Stagehand (required in V3)\n    await this.stagehand.init();\n\n    if (this.verbose) {\n      log('Stagehand initialized successfully', 'success');\n\n      // Show session URL if using Browserbase\n      if (this.stagehand.browserbaseSessionID) {\n        log(`Watch live: https://browserbase.com/sessions/${this.stagehand.browserbaseSessionID}`, 'info');\n      }\n    }\n  }\n\n  async close(): Promise<void> {\n    await this.stagehand.close();\n  }\n\n  /**\n   * Get the active page from Stagehand context\n   */\n  private getPage(): any {\n    const pages = this.stagehand.context.pages();\n    if (!pages || pages.length === 0) {\n      throw new Error('No page available in Stagehand context. Make sure initialize() was called.');\n    }\n    return pages[0];\n  }\n\n  async research(companyName: string): Promise<CompanyResearchReport> {\n    try {\n      log(`Starting research for: ${companyName}`, 'info');\n\n      // Run research tasks sequentially to avoid navigation conflicts\n      const companyInfo = await this.extractCompanyInfo(companyName);\n      const competitors = await this.extractCompetitors(companyName);\n      const news = await this.extractNews(companyName);\n      const techStack = await this.extractTechStack(companyName);\n\n      return {\n        companyInfo,\n        news,\n        techStack,\n        competitors,\n        researchDate: new Date().toISOString(),\n      };\n    } catch (error) {\n      log(`Research failed: ${error}`, 'error');\n      throw error;\n    }\n  }\n\n  private async extractCompanyInfo(companyName: string): Promise<CompanyInfo> {\n    log('Extracting company information...', 'info');\n\n    try {\n      const page = this.getPage();\n\n      // Navigate directly to the company website\n      const companyWebsite = this.guessCompanyWebsite(companyName);\n      log(`Navigating to ${companyWebsite}...`, 'info');\n\n      // Use waitUntil to handle page redirects properly\n      try {\n        await page.goto(companyWebsite, {\n          waitUntil: 'networkidle',\n          timeoutMs: 30000,\n        });\n      } catch (navError) {\n        // If navigation fails, try with domcontentloaded instead\n        log('Network idle failed, trying domcontentloaded...', 'warn');\n        await page.goto(companyWebsite, {\n          waitUntil: 'domcontentloaded',\n          timeoutMs: 30000,\n        });\n      }\n\n      await delay(5000); // Extra wait for dynamic content\n\n      // Extract company information from the website with retry logic\n      let companyInfo;\n      try {\n        log(`[Extract] Starting extraction for ${companyName} from ${companyWebsite}`, 'info');\n\n        companyInfo = await retryWithBackoff(\n          async () => {\n            return await this.stagehand.extract(\n              `You are researching ${companyName}. Use ONLY the visible page content as your source. Do not infer or use general knowledge. Do not paraphrase; use exact wording from the page. If a field is not explicitly stated on the page, return null for that field.\\n\\n` +\n              'FIELDS:\\n' +\n              `- name: \"${companyName}\" or official name from page\\n` +\n              `- description: 2-4 sentences summarizing what ${companyName} does, based only on page content\\n` +\n              `- mission: 1-3 exact sentences that describe ${companyName}'s mission or purpose as stated on the page (must include the word \"mission\" or be part of a mission statement). Do not include a company name header or repeat the company name unless it appears in the sentence.\\n` +\n              `- headquarters: City and country/state as stated on the page\\n` +\n              `- industry: Specific sector as stated on the page\\n` +\n              `- website: Official URL stated on the page`,\n              CompanyInfoSchema\n            );\n          },\n          {\n            maxRetries: 2,\n            initialDelay: 2000,\n            shouldRetry: isRetryableError,\n          }\n        );\n\n        log('Company information extracted', 'success');\n        console.log(`[Extract] Successfully extracted data:`, JSON.stringify(companyInfo, null, 2));\n\n        log('Company fields extracted from page content', 'success');\n\n        return companyInfo;\n      } catch (extractError) {\n        const errorMessage = extractError instanceof Error ? extractError.message : String(extractError);\n        const errorStack = extractError instanceof Error ? extractError.stack : undefined;\n        log(`Failed to extract company info after retries: ${errorMessage}`, 'error');\n        console.error(`[Extract] Failed to extract company info:`, {\n          error: errorMessage,\n          stack: errorStack,\n          companyName,\n          website: companyWebsite,\n          errorType: extractError?.constructor?.name,\n          errorDetails: extractError\n        });\n        throw extractError; // Re-throw to be caught by outer catch\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      const errorStack = error instanceof Error ? error.stack : undefined;\n      log(`Failed to extract company info (outer catch): ${errorMessage}`, 'error');\n      console.error(`[Extract] Outer error catch:`, {\n        error: errorMessage,\n        stack: errorStack,\n        errorType: error?.constructor?.name,\n      });\n      // Return minimal info if extraction fails\n      return {\n        name: companyName,\n        mission: 'Not found',\n        description: 'Not found',\n      };\n    }\n  }\n\n  private async extractCompetitors(companyName: string): Promise<Competitors> {\n    log('Extracting competitors...', 'info');\n\n    try {\n      const page = this.getPage();\n\n      // Use current page context (already on company website)\n      await delay(2000);\n\n      // Extract competitors using page context only\n      let competitorsData;\n      try {\n        log(`[Extract] Starting competitors extraction for ${companyName}`, 'info');\n        competitorsData = await this.stagehand.extract(\n          `From the visible content only, list up to 5 direct competitors that are actual companies (not articles, lists, communities, or forums). Use exact wording from the page; do not paraphrase.\\n` +\n          'If a competitor is not explicitly referenced on the page, omit it.\\n' +\n          'For each competitor, provide:\\n' +\n          '- Company name (official name)\\n' +\n          '- Short description based on the page (1-2 sentences)\\n' +\n          '- Website URL if explicitly shown\\n',\n          CompetitorsSchema\n        );\n        const competitors = this.sanitizeCompetitors(competitorsData.competitors || []);\n        log(`Extracted ${competitors.length} competitors`, 'success');\n        console.log(`[Extract] Successfully extracted competitors:`, JSON.stringify(competitorsData, null, 2));\n        return competitors.slice(0, 7); // Limit to 7 competitors\n      } catch (extractError) {\n        const errorMessage = extractError instanceof Error ? extractError.message : String(extractError);\n        const errorStack = extractError instanceof Error ? extractError.stack : undefined;\n        log(`Failed to extract competitors: ${errorMessage}`, 'error');\n        console.error(`[Extract] Failed to extract competitors:`, {\n          error: errorMessage,\n          stack: errorStack,\n          companyName,\n          errorType: extractError?.constructor?.name,\n          errorDetails: extractError\n        });\n        throw extractError;\n      }\n    } catch (error) {\n      log(`Failed to extract competitors: ${error}`, 'warn');\n      return [];\n    }\n  }\n\n  private async extractNews(companyName: string): Promise<News> {\n    log('Extracting recent news...', 'info');\n\n    try {\n      const page = this.getPage();\n\n      // Navigate to company newsroom or blog\n      const companyWebsite = this.guessCompanyWebsite(companyName);\n      await page.goto(`${companyWebsite}/newsroom`);\n      await delay(2000);\n\n      // Extract news items from search results\n      let newsData;\n      try {\n        log(`[Extract] Starting news extraction for ${companyName}`, 'info');\n        newsData = await this.stagehand.extract(\n          'Extract the top 5 recent news articles about this company. For each article, get the title, date, source, and a brief summary. Only include news from the last 6 months if possible.',\n          NewsSchema\n        );\n        const news = newsData.articles || [];\n        log(`Extracted ${news.length} news items`, 'success');\n        console.log(`[Extract] Successfully extracted news:`, JSON.stringify(newsData, null, 2));\n        return news.slice(0, 5); // Limit to 5 items\n      } catch (extractError) {\n        const errorMessage = extractError instanceof Error ? extractError.message : String(extractError);\n        const errorStack = extractError instanceof Error ? extractError.stack : undefined;\n        log(`Failed to extract news: ${errorMessage}`, 'error');\n        console.error(`[Extract] Failed to extract news:`, {\n          error: errorMessage,\n          stack: errorStack,\n          companyName,\n          errorType: extractError?.constructor?.name,\n          errorDetails: extractError\n        });\n        throw extractError; // Re-throw to be caught by outer catch\n      }\n    } catch (error) {\n      log(`Failed to extract news: ${error}`, 'warn');\n      return [];\n    }\n  }\n\n  private async extractTechStack(companyName: string): Promise<TechStack> {\n    log('Detecting tech stack...', 'info');\n\n    try {\n      const page = this.getPage();\n\n      // Navigate to company careers page\n      const companyWebsite = this.guessCompanyWebsite(companyName);\n      await page.goto(`${companyWebsite}/careers`);\n      await delay(3000);\n\n      // Extract tech stack\n      let techStack;\n      try {\n        log(`[Extract] Starting tech stack extraction for ${companyName}`, 'info');\n        techStack = await this.stagehand.extract(\n          'Extract information about the technologies used by this company. Look for programming languages, frameworks, tools, and infrastructure. If this is a careers page, look at job listings for required skills. If this is a tech blog, look at technologies mentioned.',\n          TechStackSchema\n        );\n        log('Tech stack detected', 'success');\n        console.log(`[Extract] Successfully extracted tech stack:`, JSON.stringify(techStack, null, 2));\n        return techStack;\n      } catch (extractError) {\n        const errorMessage = extractError instanceof Error ? extractError.message : String(extractError);\n        const errorStack = extractError instanceof Error ? extractError.stack : undefined;\n        log(`Failed to extract tech stack: ${errorMessage}`, 'error');\n        console.error(`[Extract] Failed to extract tech stack:`, {\n          error: errorMessage,\n          stack: errorStack,\n          companyName,\n          errorType: extractError?.constructor?.name,\n          errorDetails: extractError\n        });\n        throw extractError; // Re-throw to be caught by outer catch\n      }\n    } catch (error) {\n      log(`Failed to extract tech stack: ${error}`, 'warn');\n      // Return empty tech stack if extraction fails\n      return {\n        languages: [],\n        frameworks: [],\n        tools: [],\n        infrastructure: [],\n      };\n    }\n  }\n\n  /**\n   * Extract recruiters from LinkedIn and company website\n   * Searches for recruiters, talent acquisition, and HR professionals\n   */\n  async extractRecruiters(companyName: string): Promise<Recruiters> {\n    log('Extracting recruiters...', 'info');\n\n    const recruiters: Recruiters = [];\n\n    try {\n      const page = this.getPage();\n\n      // Step 1: Try LinkedIn search for recruiters\n      log('Searching LinkedIn for recruiters...', 'info');\n      try {\n        // Search LinkedIn for company recruiters\n        const linkedInSearchUrl = `https://www.linkedin.com/search/results/people/?keywords=${encodeURIComponent(companyName + ' recruiter')}&origin=GLOBAL_SEARCH_HEADER`;\n        await page.goto(linkedInSearchUrl, {\n          waitUntil: 'domcontentloaded',\n          timeoutMs: 30000,\n        });\n        await delay(3000); // Wait for content to load\n\n        // Extract recruiter profiles from LinkedIn search results\n        const linkedInRecruiters = await retryWithBackoff(\n          async () => {\n            return await this.stagehand.extract(\n              `Extract recruiter profiles from LinkedIn search results. Look for people with titles containing \"Recruiter\", \"Talent Acquisition\", \"HR\", \"People Operations\", or similar recruiting roles at ${companyName}.\\n\\n` +\n              'For each person found, extract:\\n' +\n              '- Full name\\n' +\n              '- Job title (exact title from their profile)\\n' +\n              '- LinkedIn profile URL\\n' +\n              '- Department they recruit for (if mentioned)\\n\\n' +\n              `Only include people who work at or recruit for ${companyName}. Limit to 10 recruiters.`,\n              RecruitersSchema\n            );\n          },\n          {\n            maxRetries: 2,\n            initialDelay: 2000,\n            shouldRetry: isRetryableError,\n          }\n        );\n\n        if (linkedInRecruiters?.recruiters?.length > 0) {\n          recruiters.push(...linkedInRecruiters.recruiters);\n          log(`Found ${linkedInRecruiters.recruiters.length} recruiters on LinkedIn`, 'success');\n        }\n      } catch (linkedInError) {\n        log(`LinkedIn search failed: ${linkedInError instanceof Error ? linkedInError.message : linkedInError}`, 'warn');\n      }\n\n      // Step 2: Check company careers/team page\n      log('Checking company careers/team page...', 'info');\n      try {\n        const companyWebsite = this.guessCompanyWebsite(companyName);\n\n        // Try careers page first\n        await page.goto(`${companyWebsite}/careers`, {\n          waitUntil: 'domcontentloaded',\n          timeoutMs: 20000,\n        });\n        await delay(2000);\n\n        const careersRecruiters = await this.stagehand.extract(\n          `Look for recruiting team members, HR contacts, or talent acquisition professionals on this page.\\n\\n` +\n          'Extract:\\n' +\n          '- Full name\\n' +\n          '- Job title\\n' +\n          '- Email (if publicly listed)\\n' +\n          '- Department they recruit for\\n\\n' +\n          'Also check for \"Contact Recruiting\", \"Meet Our Team\", or similar sections.',\n          RecruitersSchema\n        );\n\n        if (careersRecruiters?.recruiters?.length > 0) {\n          // Avoid duplicates by checking names\n          const existingNames = new Set(recruiters.map(r => r.name.toLowerCase()));\n          const newRecruiters = careersRecruiters.recruiters.filter(\n            r => !existingNames.has(r.name.toLowerCase())\n          );\n          recruiters.push(...newRecruiters);\n          log(`Found ${newRecruiters.length} additional recruiters on careers page`, 'success');\n        }\n      } catch (careersError) {\n        log(`Careers page search failed: ${careersError instanceof Error ? careersError.message : careersError}`, 'warn');\n      }\n\n      // Step 3: Try team/about page\n      try {\n        const companyWebsite = this.guessCompanyWebsite(companyName);\n        await page.goto(`${companyWebsite}/about`, {\n          waitUntil: 'domcontentloaded',\n          timeoutMs: 20000,\n        });\n        await delay(2000);\n\n        const teamRecruiters = await this.stagehand.extract(\n          `Look for HR, People Operations, or Recruiting team members on this about/team page.\\n\\n` +\n          'Extract:\\n' +\n          '- Full name\\n' +\n          '- Job title (look for titles with HR, Recruiting, Talent, People in them)\\n' +\n          '- LinkedIn URL (if available)\\n' +\n          '- Department\\n',\n          RecruitersSchema\n        );\n\n        if (teamRecruiters?.recruiters?.length > 0) {\n          const existingNames = new Set(recruiters.map(r => r.name.toLowerCase()));\n          const newRecruiters = teamRecruiters.recruiters.filter(\n            r => !existingNames.has(r.name.toLowerCase())\n          );\n          recruiters.push(...newRecruiters);\n          log(`Found ${newRecruiters.length} additional recruiters on about page`, 'success');\n        }\n      } catch (aboutError) {\n        log(`About page search failed: ${aboutError instanceof Error ? aboutError.message : aboutError}`, 'warn');\n      }\n\n      // Step 4: Use LLM knowledge as fallback for well-known companies\n      if (recruiters.length === 0) {\n        log('No recruiters found, using LLM knowledge...', 'info');\n        try {\n          const knowledgeRecruiters = await this.stagehand.extract(\n            `Based on your knowledge, who are some known recruiters or talent acquisition professionals at ${companyName}?\\n\\n` +\n            'For well-known companies, you may have information about:\\n' +\n            '- Head of Recruiting / Talent Acquisition\\n' +\n            '- Technical Recruiters\\n' +\n            '- University Recruiters\\n' +\n            '- HR Leadership\\n\\n' +\n            'Provide names and titles if known. Include LinkedIn URLs if you know them.',\n            RecruitersSchema\n          );\n\n          if (knowledgeRecruiters?.recruiters?.length > 0) {\n            recruiters.push(...knowledgeRecruiters.recruiters);\n            log(`Added ${knowledgeRecruiters.recruiters.length} recruiters from LLM knowledge`, 'success');\n          }\n        } catch (knowledgeError) {\n          log(`LLM knowledge extraction failed: ${knowledgeError instanceof Error ? knowledgeError.message : knowledgeError}`, 'warn');\n        }\n      }\n\n      log(`Total recruiters found: ${recruiters.length}`, 'success');\n      return recruiters.slice(0, 10); // Limit to 10 recruiters\n\n    } catch (error) {\n      log(`Failed to extract recruiters: ${error}`, 'error');\n      return [];\n    }\n  }\n\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1237, "column": 0}, "map": {"version":3,"sources":["file:///Users/nishibhagat/stagehandsdk/src/report-generator.ts"],"sourcesContent":["import { writeFile } from 'fs/promises';\nimport { CompanyResearchReport } from './types';\nimport { log, sanitizeFilename, formatDate } from './utils';\n\nexport class ReportGenerator {\n  async generateMarkdown(report: CompanyResearchReport): Promise<string> {\n    const { companyInfo, news, techStack, competitors, researchDate } = report;\n\n    const cleanText = (value?: string | null, fallback: string = 'Not Available') => {\n      if (!value) return fallback;\n      const cleaned = value\n        .replace(/^\\s*#+\\s*/g, '')\n        .replace(/\\s*\\n+\\s*/g, ' ')\n        .replace(/\\s{2,}/g, ' ')\n        .trim();\n      return cleaned || fallback;\n    };\n\n    const sanitizeNarrative = (value: string, companyName: string): string => {\n      if (!value || value === 'Not Available') return 'Not Available';\n      const blockedPhrases = [\n        /one little project/i,\n        /annual revenue/i,\n        /total funding/i,\n        /\\bemploys\\b/i,\n        /\\byoy\\b/i,\n      ];\n      const withoutHeader = value.replace(new RegExp(`^${companyName}\\\\s*\\\\([^)]*\\\\)\\\\s*`, 'i'), '').trim();\n      const sentences = withoutHeader.split(/(?<=[.!?])\\s+/);\n      const kept = sentences.filter((sentence) => {\n        const trimmed = sentence.trim();\n        if (!trimmed) return false;\n        if (blockedPhrases.some((pattern) => pattern.test(trimmed))) return false;\n        const mentionsCompany = trimmed.toLowerCase().includes(companyName.toLowerCase());\n        const allowedStart = /^(it|the company|this company|they|its|we|our)\\b/i.test(trimmed);\n        const containsGenericCompanyClaim = /\\bis a company that\\b/i.test(trimmed);\n        if (containsGenericCompanyClaim && !mentionsCompany) return false;\n        return mentionsCompany || allowedStart;\n      });\n      const unique = Array.from(new Set(kept.map((sentence) => sentence.trim()))).filter(Boolean);\n      const cleaned = unique.join(' ').trim();\n      if (!cleaned) return 'Not Available';\n      return /[.!?]$/.test(cleaned) ? cleaned : `${cleaned}.`;\n    };\n\n    const formatStackItem = (value: string): string => {\n      const trimmed = value.trim();\n      if (!trimmed) return trimmed;\n      const normalized = trimmed.toLowerCase();\n      const map: Record<string, string> = {\n        'javascript': 'JavaScript',\n        'typescript': 'TypeScript',\n        'node.js': 'Node.js',\n        'next.js': 'Next.js',\n        'react': 'React',\n        'vue': 'Vue',\n        'angular': 'Angular',\n        'go': 'Go',\n        'rust': 'Rust',\n        'scala': 'Scala',\n        'kubernetes': 'Kubernetes',\n        'git': 'Git',\n        'terraform': 'Terraform',\n        'vercel': 'Vercel',\n        'aws': 'AWS',\n        'gcp': 'GCP',\n        'sql': 'SQL',\n        'nosql': 'NoSQL',\n        'api': 'API',\n        'sdk': 'SDK',\n        'ci': 'CI',\n        'cd': 'CD',\n        'cdn': 'CDN',\n        'graphql': 'GraphQL',\n        'grpc': 'gRPC',\n        'http': 'HTTP',\n        'https': 'HTTPS',\n      };\n      if (map[normalized]) return map[normalized];\n      if (/[A-Z]/.test(trimmed)) return trimmed;\n      return trimmed\n        .split(' ')\n        .map((word) => {\n          if (!word) return word;\n          if (map[word.toLowerCase()]) return map[word.toLowerCase()];\n          return word[0].toUpperCase() + word.slice(1);\n        })\n        .join(' ');\n    };\n\n    let markdown = '';\n\n    // Header\n    markdown += `Company Research Report\\n\\n`;\n    markdown += `Company: ${companyInfo.name}\\n`;\n    markdown += `Research Date: ${formatDate()}\\n\\n`;\n\n    // Company Information\n    const overview = sanitizeNarrative(cleanText(companyInfo.description, 'Not Available'), companyInfo.name);\n    const mission = sanitizeNarrative(cleanText(companyInfo.mission), companyInfo.name);\n    markdown += `Company Overview\\n`;\n    markdown += `Mission: ${mission}\\n\\n`;\n    markdown += `${overview === 'Not Available' ? 'No Description Available' : overview}\\n\\n`;\n\n    if (companyInfo.headquarters || companyInfo.industry || companyInfo.website) {\n      markdown += `Key Facts\\n`;\n      if (companyInfo.headquarters) markdown += `Headquarters: ${companyInfo.headquarters}\\n`;\n      if (companyInfo.industry) markdown += `Industry: ${companyInfo.industry}\\n`;\n      if (companyInfo.website) markdown += `Website: ${companyInfo.website}\\n`;\n      markdown += `\\n`;\n    }\n\n    // Recent News\n    markdown += `Recent News\\n\\n`;\n    if (news.length > 0) {\n      news.forEach((item, index) => {\n        markdown += `${index + 1}. ${item.title}\\n`;\n        markdown += `Date: ${item.date} | Source: ${item.source}\\n`;\n        markdown += `${item.summary}\\n`;\n        if (item.url) {\n          markdown += `Read More: ${item.url}\\n`;\n        }\n        markdown += `\\n`;\n      });\n    } else {\n      markdown += `No Recent News Found\\n\\n`;\n    }\n\n    // Tech Stack\n    markdown += `Technology Stack\\n\\n`;\n\n    if (techStack.languages.length > 0) {\n      const languages = techStack.languages.map(formatStackItem).join(', ');\n      markdown += `Programming Languages: ${languages}\\n\\n`;\n    }\n\n    if (techStack.frameworks.length > 0) {\n      const frameworks = techStack.frameworks.map(formatStackItem).join(', ');\n      markdown += `Frameworks and Libraries: ${frameworks}\\n\\n`;\n    }\n\n    if (techStack.tools.length > 0) {\n      const tools = techStack.tools.map(formatStackItem).join(', ');\n      markdown += `Tools and Platforms: ${tools}\\n\\n`;\n    }\n\n    if (techStack.infrastructure.length > 0) {\n      const infrastructure = techStack.infrastructure.map(formatStackItem).join(', ');\n      markdown += `Infrastructure: ${infrastructure}\\n\\n`;\n    }\n\n    if (\n      techStack.languages.length === 0 &&\n      techStack.frameworks.length === 0 &&\n      techStack.tools.length === 0 &&\n      techStack.infrastructure.length === 0\n    ) {\n      markdown += `Tech Stack Information Not Found\\n\\n`;\n    }\n\n    // Competitors\n    markdown += `Competitors\\n\\n`;\n    if (competitors.length > 0) {\n      competitors.forEach(competitor => {\n        const description = sanitizeNarrative(cleanText(competitor.description, 'Not Available'), competitor.name);\n        markdown += `Name: ${competitor.name}\\n`;\n        markdown += `Description: ${description === 'Not Available' ? 'No Description Available' : description}\\n`;\n        if (competitor.website) {\n          markdown += `Website: ${competitor.website}\\n`;\n        }\n        markdown += `\\n`;\n      });\n    } else {\n      markdown += `No Competitor Information Found\\n\\n`;\n    }\n\n    // Footer\n    markdown += `Report Generated On ${researchDate} Using Automated Research Tools\\n`;\n\n    return markdown;\n  }\n\n  async saveReport(report: CompanyResearchReport, outputPath?: string): Promise<string> {\n    const markdown = await this.generateMarkdown(report);\n    const filename = outputPath || `${sanitizeFilename(report.companyInfo.name)}-research-${formatDate()}.md`;\n\n    await writeFile(filename, markdown, 'utf-8');\n    log(`Report saved to: ${filename}`, 'success');\n\n    return filename;\n  }\n\n  async displayReport(report: CompanyResearchReport): Promise<void> {\n    const markdown = await this.generateMarkdown(report);\n    console.log('\\n' + markdown);\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1409, "column": 0}, "map": {"version":3,"sources":["file:///Users/nishibhagat/stagehandsdk/app/api/research/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { ExaResearcher, isExaAvailable } from '../../../src/exa-researcher';\nimport { CompanyResearcher } from '../../../src/scraper';\nimport { ReportGenerator } from '../../../src/report-generator';\n\nexport const maxDuration = 300; // 5 minutes timeout\n\nexport async function POST(request: NextRequest) {\n  const startTime = Date.now();\n\n  try {\n    const body = await request.json() as { companyName?: string; useExa?: boolean };\n    const { companyName, useExa = true } = body;\n\n    if (!companyName) {\n      return NextResponse.json(\n        { error: 'Company name is required' },\n        { status: 400 }\n      );\n    }\n\n    console.log(`[Research API] Starting research for: ${companyName}`);\n\n    let report;\n    let method: string = 'none';\n\n    // Try Exa first (fast) if available and requested\n    if (useExa && isExaAvailable()) {\n      console.log('[Research API] Using Exa (fast mode)');\n      method = 'exa';\n\n      try {\n        const exaResearcher = new ExaResearcher();\n        report = await exaResearcher.research(companyName);\n      } catch (exaError) {\n        console.warn('[Research API] Exa failed, falling back to Stagehand:', exaError);\n        // Fall through to Stagehand\n        method = 'stagehand-fallback';\n      }\n    }\n\n    // Fallback to Stagehand (slower but more thorough)\n    if (!report) {\n      if (!process.env.GOOGLE_API_KEY && !process.env.ANTHROPIC_API_KEY && !process.env.OPENAI_API_KEY) {\n        return NextResponse.json(\n          { error: 'No API key configured. Please add EXA_API_KEY or GOOGLE_API_KEY.' },\n          { status: 500 }\n        );\n      }\n\n      console.log('[Research API] Using Stagehand (browser mode)');\n      method = method || 'stagehand';\n\n      const researcher = new CompanyResearcher(false);\n      try {\n        await researcher.initialize();\n        report = await researcher.research(companyName);\n        await researcher.close();\n      } catch (stagehandError) {\n        try {\n          await researcher.close();\n        } catch {}\n        throw stagehandError;\n      }\n    }\n\n    const reportGenerator = new ReportGenerator();\n    const markdown = await reportGenerator.generateMarkdown(report);\n\n    const duration = ((Date.now() - startTime) / 1000).toFixed(2);\n    console.log(`[Research API] Completed in ${duration}s using ${method}`);\n\n    return NextResponse.json({\n      markdown,\n      report,\n      meta: {\n        method,\n        durationSeconds: parseFloat(duration),\n      },\n    });\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    console.error('[Research API] Error:', errorMessage);\n\n    return NextResponse.json(\n      { error: errorMessage },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAEO,MAAM,cAAc,KAAK,oBAAoB;AAE7C,eAAe,KAAK,OAAoB;IAC7C,MAAM,YAAY,KAAK,GAAG;IAE1B,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,WAAW,EAAE,SAAS,IAAI,EAAE,GAAG;QAEvC,IAAI,CAAC,aAAa;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2B,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,GAAG,CAAC,CAAC,sCAAsC,EAAE,aAAa;QAElE,IAAI;QACJ,IAAI,SAAiB;QAErB,kDAAkD;QAClD,IAAI,UAAU,IAAA,4IAAc,KAAI;YAC9B,QAAQ,GAAG,CAAC;YACZ,SAAS;YAET,IAAI;gBACF,MAAM,gBAAgB,IAAI,2IAAa;gBACvC,SAAS,MAAM,cAAc,QAAQ,CAAC;YACxC,EAAE,OAAO,UAAU;gBACjB,QAAQ,IAAI,CAAC,yDAAyD;gBACtE,4BAA4B;gBAC5B,SAAS;YACX;QACF;QAEA,mDAAmD;QACnD,IAAI,CAAC,QAAQ;YACX,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,IAAI,CAAC,QAAQ,GAAG,CAAC,iBAAiB,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;gBAChG,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAAmE,GAC5E;oBAAE,QAAQ;gBAAI;YAElB;YAEA,QAAQ,GAAG,CAAC;YACZ,SAAS,UAAU;YAEnB,MAAM,aAAa,IAAI,qIAAiB,CAAC;YACzC,IAAI;gBACF,MAAM,WAAW,UAAU;gBAC3B,SAAS,MAAM,WAAW,QAAQ,CAAC;gBACnC,MAAM,WAAW,KAAK;YACxB,EAAE,OAAO,gBAAgB;gBACvB,IAAI;oBACF,MAAM,WAAW,KAAK;gBACxB,EAAE,OAAM,CAAC;gBACT,MAAM;YACR;QACF;QAEA,MAAM,kBAAkB,IAAI,+IAAe;QAC3C,MAAM,WAAW,MAAM,gBAAgB,gBAAgB,CAAC;QAExD,MAAM,WAAW,CAAC,CAAC,KAAK,GAAG,KAAK,SAAS,IAAI,IAAI,EAAE,OAAO,CAAC;QAC3D,QAAQ,GAAG,CAAC,CAAC,4BAA4B,EAAE,SAAS,QAAQ,EAAE,QAAQ;QAEtE,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA,MAAM;gBACJ;gBACA,iBAAiB,WAAW;YAC9B;QACF;IACF,EAAE,OAAO,OAAO;QACd,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QACrE,QAAQ,KAAK,CAAC,yBAAyB;QAEvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAa,GACtB;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}